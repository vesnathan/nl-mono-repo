#!/bin/bash

# Example restart-dev.sh for agent workspaces
# Copy this file and modify the port number for your workspace
#
# Usage:
#   1. Copy this file: cp restart-dev.sh.example restart-dev.sh
#   2. Update the port number below (3001, 3002, 3003, etc.)
#   3. Run: ./restart-dev.sh

# Change this port number for your workspace:
# - Main repo: 3000 (default)
# - Agent-1: 3001
# - Agent-2: 3002
# - Agent-3: 3003, etc.
PORT=3001

echo "🧹 Cleaning Next.js cache..."
rm -rf .next

echo "🔍 Killing any existing Next.js processes on port $PORT..."
lsof -ti:$PORT | xargs kill -9 2>/dev/null || true

echo "🧹 Clearing Node.js cache..."
rm -rf node_modules/.cache

echo "✅ Cleanup complete!"
echo "🚀 Starting dev server with increased memory on port $PORT..."

# Ensure the dev server runs in development mode
export NODE_ENV=development
export NEXT_PUBLIC_ENVIRONMENT=dev
export NODE_OPTIONS="--max-old-space-size=4096"

# Run the Next.js dev server
yarn dev -- -p $PORT -H 0.0.0.0
