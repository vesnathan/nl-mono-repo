/**********************************************************************************************************************
 *                                                                                                                    *
 *  DO NOT EDIT THIS FILE.                                                                                            *
 *                                                                                                                    *
 *  This file is automatically generated by the build process.                                                        *
 *                                                                                                                    *
 *  Source file: ../cloudwatchlive/backend/resources/AppSync/resolvers/users/Queries/Query.getCWLUser.ts                                                                                *
 *                                                                                                                    *
 **********************************************************************************************************************/

// ../../../../tmp/nl_resolver_build_dev_1750834287076/Query.getCWLUser.ts
import { util } from "@aws-appsync/utils";

// ../../../../tmp/nl_resolver_build_dev_1750834287076/gqlTypes.ts
var ClientType = /* @__PURE__ */ ((ClientType2) => {
  ClientType2["SuperAdmin"] = "SuperAdmin";
  ClientType2["EventCompanyAdmin"] = "EventCompanyAdmin";
  ClientType2["EventCompanyStaff"] = "EventCompanyStaff";
  ClientType2["TechCompanyAdmin"] = "TechCompanyAdmin";
  ClientType2["TechCompanyStaff"] = "TechCompanyStaff";
  ClientType2["RegisteredAttendee"] = "RegisteredAttendee";
  ClientType2["UnregisteredAttendee"] = "UnregisteredAttendee";
  return ClientType2;
})(ClientType || {});

// ../../../../tmp/nl_resolver_build_dev_1750834287076/ClientTypes.ts
var CWL_CLIENT_TYPES = [
  "SuperAdmin",
  "EventCompanyAdmin",
  "EventCompanyStaff",
  "TechCompanyAdmin",
  "TechCompanyStaff",
  "RegisteredAttendee",
  "UnregisteredAttendee"
];
var isValidCWLClientType = (value) => {
  return CWL_CLIENT_TYPES.includes(value);
};

// ../../../../tmp/nl_resolver_build_dev_1750834287076/Query.getCWLUser.ts
function request(ctx) {
  const args = ctx.args;
  const { userId } = args;
  if (!userId) {
    return util.error(
      "User ID is missing in the request.",
      "ValidationException"
    );
  }
  const identity = ctx.identity;
  if (identity.username !== userId) {
    return util.error(
      "User is not allowed to retrieve data of a different user",
      "Unauthorized"
    );
  }
  console.log(`Getting user data for userId: ${userId}`);
  console.log(`Identity username: ${identity.username}`);
  return {
    operation: "GetItem",
    key: util.dynamodb.toMapValues({ userId })
  };
}
function response(ctx) {
  console.log("Response result:", JSON.stringify(ctx.result));
  if (ctx.error) {
    console.error("Error in resolver:", ctx.error);
    return util.error(ctx.error.message, ctx.error.type);
  }
  const identity = ctx.identity;
  const args = ctx.args;
  const { userId } = args;
  if (!ctx.result) {
    console.error(`User not found in DynamoDB for userId: ${userId}`);
    console.error(`Identity username: ${identity.username}`);
    console.error(`Identity groups: ${JSON.stringify(identity.groups)}`);
    return util.error(
      `User profile not found. Please contact support if this issue persists. UserId: ${userId}`,
      "UserNotFound"
    );
  }
  const userFromDB = ctx.result;
  const cognitoGroups = identity.groups || [];
  console.log(`Cognito groups for user ${userId}:`, JSON.stringify(cognitoGroups));
  const clientType = [];
  for (const group of cognitoGroups) {
    if (isValidCWLClientType(group)) {
      clientType.push(ClientType[group]);
      console.log(`Mapped group "${group}" to ClientType.${group}`);
    } else {
      console.log(`Unknown group: ${group}, not mapping to any ClientType`);
    }
  }
  if (clientType.length === 0) {
    console.log(`No groups mapped to ClientType, adding default UnregisteredAttendee`);
    clientType.push("UnregisteredAttendee" /* UnregisteredAttendee */);
  }
  console.log(`Final clientType array:`, JSON.stringify(clientType));
  const resolvedUser = {
    ...userFromDB,
    // Spread raw DB result
    userId: userFromDB.userId || userId,
    // Ensure userId is present
    clientType
    // Ensure other non-nullable fields from CWLUser are present, e.g.:
    // email: userFromDB.email || "", 
    // username: userFromDB.username || "",
    // createdAt: userFromDB.createdAt || new Date().toISOString(),
    // updatedAt: userFromDB.updatedAt || new Date().toISOString(),
    // Add other fields as defined in CWLUser type from gqlTypes.ts
    // If fields are optional in DB but non-nullable in GQL, provide defaults or ensure they exist.
  };
  return resolvedUser;
}
export {
  request,
  response
};
